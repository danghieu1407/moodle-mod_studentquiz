{"version":3,"file":"studentquiz.min.js","sources":["../src/studentquiz.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript for save rating and save, remove and listing comments\n *\n * @module    mod_studentquiz/studentquiz\n * @copyright 2017 HSR (http://www.hsr.ch)\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/* jshint latedef:nofunc */\n\ndefine(['jquery'], function($) {\n    return {\n        initialise: function(forcerating, forcecommenting, isanswered) {\n\n            var ratingElements = $(\".studentquiz_behaviour .rate .rating .rateable\");\n            // Ajax request POST on CLICK for add rating.\n            ratingElements.off(\"click\").on(\"click\", function() {\n                addRating(this);\n            });\n            // Ajax request POST for add rating when \"Enter\" or \"Space\" is pressed.\n            ratingElements.on(\"keypress\", function(e) {\n                if (e.keyCode === 13 || e.keyCode === 32) {\n                    e.preventDefault();\n                    addRating(this);\n                }\n            });\n\n            // On CLICK check if student submitted result and has rated if not abort and show error for rating.\n            $('input[name=\"next\"], input[name=\"previous\"], input[name=\"finish\"]').off('click').on('click', function() {\n                var $that = $(this);\n\n                if (isanswered) {\n                    var hasrated = $('.rating span').hasClass('star');\n                    var hascommented = $('.studentquiz-comment-container').hasClass('has-comment');\n\n                    if (forcerating && !hasrated) {\n                        $('.studentquiz_behaviour > .rate > .rate_error').removeClass('hide');\n                    }\n                    if (forcecommenting && !hascommented) {\n                        $('.studentquiz_behaviour > .comments .comment-error').removeClass('hide');\n                    }\n\n                    // Set focus.\n                    if (forcerating && !hasrated) {\n                        // Set focus to the first star.\n                        $('.studentquiz_behaviour .rate .rating .rateable:first-child').focus();\n                    } else if (forcecommenting && !hascommented) {\n                        const attoEditorSelector = $(\n                            '.studentquiz_behaviour .comments .studentquiz-comment-container .editor_atto_content'\n                        );\n                        const tinyMceEditorSelector = $(\n                            '.studentquiz_behaviour .comments .studentquiz-comment-container .tox-edit-area'\n                        );\n                        const textareaSelector = $('textarea[id^=\"id_editor_question_\"]');\n                        if (attoEditorSelector.length > 0) {\n                            // Set focus to atto editor.\n                            attoEditorSelector.focus();\n                        } else if (tinyMceEditorSelector.length > 0) {\n                            const tinyEditorId = textareaSelector.attr('id');\n                            // Set focus to TinyMCE editor.\n                            window.tinymce.get(tinyEditorId).focus();\n                        } else {\n                            // Set focus to textarea.\n                            textareaSelector.focus();\n                        }\n                    }\n\n                    if ((!forcerating || hasrated) && (!forcecommenting || hascommented)) {\n                        $that.submit();\n                        return true;\n                    }\n                    return false;\n                } else {\n                    $that.submit();\n                    return true;\n                }\n            });\n        },\n\n        // Set focus to sorted head of question table.\n        setFocus: function() {\n            $(document).ready(function() {\n                var sortIcon = $('#categoryquestions .iconsort');\n                if (sortIcon) {\n                    sortIcon.parent().focus();\n                }\n            });\n        },\n\n        // Select all questions.\n        selectAllQuestions: function() {\n            let headerCheckbox = document.getElementById('qbheadercheckbox');\n\n            require(['core/checkbox-toggleall'], () => {\n                if (!headerCheckbox.checked) {\n                    headerCheckbox.click();\n                }\n            });\n        }\n    };\n\n    /**\n     * Add rating to question.\n     *\n     * @param {DOM} element\n     */\n    function addRating(element) {\n        var $element = $(element);\n        var rate = $element.attr('data-rate');\n        var $that = $element;\n        var $cmIdField = $element.closest('form').find('.cmid_field');\n        var cmid = $cmIdField.attr('value');\n        $.post(M.cfg.wwwroot + '/mod/studentquiz/save.php',\n            {\n                save: 'rate',\n                cmid: cmid,\n                studentquizquestionid: $element.attr('data-studentquizquestionid'),\n                sesskey: M.cfg.sesskey,\n                rate: rate\n            },\n            function() {\n                var $ratingStars = $that.closest('.rating').children('span');\n                $ratingStars.removeClass('star');\n                $ratingStars.addClass('star-empty');\n                $ratingStars.each(function() {\n                    if ($(this).attr('data-rate') <= rate) {\n                        $(this).removeClass('star-empty');\n                        $(this).addClass('star');\n                    }\n                });\n                $('.studentquiz_behaviour > .rate > .rate_error').addClass('hide');\n            }\n        );\n    }\n});\n"],"names":["define","$","initialise","forcerating","forcecommenting","isanswered","ratingElements","off","on","addRating","this","e","keyCode","preventDefault","$that","hasrated","hasClass","hascommented","removeClass","focus","attoEditorSelector","tinyMceEditorSelector","textareaSelector","length","tinyEditorId","attr","window","tinymce","get","submit","setFocus","document","ready","sortIcon","parent","selectAllQuestions","headerCheckbox","getElementById","require","checked","click","element","$element","rate","cmid","closest","find","post","M","cfg","wwwroot","save","studentquizquestionid","sesskey","$ratingStars","children","addClass","each"],"mappings":";;;;;;;AAyBAA,qCAAO,CAAC,WAAW,SAASC,SACjB,CACHC,WAAY,SAASC,YAAaC,gBAAiBC,gBAE3CC,eAAiBL,EAAE,kDAEvBK,eAAeC,IAAI,SAASC,GAAG,SAAS,WACpCC,UAAUC,SAGdJ,eAAeE,GAAG,YAAY,SAASG,GACjB,KAAdA,EAAEC,SAAgC,KAAdD,EAAEC,UACtBD,EAAEE,iBACFJ,UAAUC,UAKlBT,EAAE,oEAAoEM,IAAI,SAASC,GAAG,SAAS,eACvFM,MAAQb,EAAES,SAEVL,WAAY,KACRU,SAAWd,EAAE,gBAAgBe,SAAS,QACtCC,aAAehB,EAAE,kCAAkCe,SAAS,kBAE5Db,cAAgBY,UAChBd,EAAE,gDAAgDiB,YAAY,QAE9Dd,kBAAoBa,cACpBhB,EAAE,qDAAqDiB,YAAY,QAInEf,cAAgBY,SAEhBd,EAAE,8DAA8DkB,aAC7D,GAAIf,kBAAoBa,aAAc,OACnCG,mBAAqBnB,EACvB,wFAEEoB,sBAAwBpB,EAC1B,kFAEEqB,iBAAmBrB,EAAE,0CACvBmB,mBAAmBG,OAAS,EAE5BH,mBAAmBD,aAChB,GAAIE,sBAAsBE,OAAS,EAAG,OACnCC,aAAeF,iBAAiBG,KAAK,MAE3CC,OAAOC,QAAQC,IAAIJ,cAAcL,aAGjCG,iBAAiBH,gBAInBhB,cAAeY,UAAeX,kBAAmBa,gBACnDH,MAAMe,UACC,UAIXf,MAAMe,UACC,MAMnBC,SAAU,WACN7B,EAAE8B,UAAUC,OAAM,eACVC,SAAWhC,EAAE,gCACbgC,UACAA,SAASC,SAASf,YAM9BgB,mBAAoB,eACZC,eAAiBL,SAASM,eAAe,oBAE7CC,QAAQ,CAAC,4BAA4B,KAC5BF,eAAeG,SAChBH,eAAeI,sBAWtB/B,UAAUgC,aACXC,SAAWzC,EAAEwC,SACbE,KAAOD,SAASjB,KAAK,aACrBX,MAAQ4B,SAERE,KADaF,SAASG,QAAQ,QAAQC,KAAK,eACzBrB,KAAK,SAC3BxB,EAAE8C,KAAKC,EAAEC,IAAIC,QAAU,4BACnB,CACIC,KAAM,OACNP,KAAMA,KACNQ,sBAAuBV,SAASjB,KAAK,8BACrC4B,QAASL,EAAEC,IAAII,QACfV,KAAMA,OAEV,eACQW,aAAexC,MAAM+B,QAAQ,WAAWU,SAAS,QACrDD,aAAapC,YAAY,QACzBoC,aAAaE,SAAS,cACtBF,aAAaG,MAAK,WACVxD,EAAES,MAAMe,KAAK,cAAgBkB,OAC7B1C,EAAES,MAAMQ,YAAY,cACpBjB,EAAES,MAAM8C,SAAS,YAGzBvD,EAAE,gDAAgDuD,SAAS"}